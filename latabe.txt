## HTML File ##

<!DOCTYPE html>
<html lang="en">

    <head>
        <title>Assignment 01</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="reset.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body>
        <div class="d-flex justify-content-center"> <!-- Center the Container -->
            <div class="container m-5">
                <form class="d-flex justify-content-center">
                    <input style='background-color: rgb(243, 243, 243); width: 20rem; padding: 0.75rem 2rem;' class='form-control form-control-secondary border rounded-pill' type="text" id="amount_input" name="amount_input" placeholder="Enter number of random users">
                </form>
            </div>
        </div>
        <div class="container" id="body">
            <div class="row">
                <div class="col-md-3 d-flex justify-content-center" id="name">
                    <form>
                        <select style='background-color: rgb(243, 243, 243); width: 15rem; padding: 0.75rem 2rem;' class='text-center fw-semibold form-control form-control-secondary border rounded-pill' id="sort_by">
                            <option value="first_name">First Name</option>
                            <option value="last_name">Last Name</option>
                        </select>
                    </form>
                </div>
                <div class="col-md-3 d-flex justify-content-center" id="gender">
                    <h6 style='background-color: rgb(243, 243, 243); width: 15rem; padding: 0.75rem 2rem;' class='text-center border rounded-pill'>Gender</h6>
                </div>
                <div class="col-md-3 d-flex justify-content-center" id="email">
                    <h6 style='background-color: rgb(243, 243, 243); width: 15rem; padding: 0.75rem 2rem;' class='text-center border rounded-pill'>Email Address</h6>
                </div>
                <div class="col-md-3 d-flex justify-content-center" id="country">
                    <h6 style='background-color: rgb(243, 243, 243); width: 15rem; padding: 0.75rem 2rem;' class='text-center border rounded-pill'>Country</h6>
                </div>
            </div>
        </div>

        <!-- Modal for the User Description -->
        <div class="modal fade" id="userDescriptionModal" tabindex="-1" aria-labelledby="userDescriptionModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 70%;">
                <div class="modal-content" style="background-color: gray; border-radius: 20px; padding: 30px;">

                    <!-- Header -->
                    <div class="modal-header border-0 d-flex justify-content-center bg-transparent">
                        <!-- Circle with initials to simulate pfp image -->
                        <div class="d-flex align-items-center justify-content-center fw-bold"
                            style="width: 90px; height: 90px; background: white; color: black; font-size: 28px; border-radius: 50%;" id="initials">
                        
                        </div>
                    </div>

                    <!-- Body -->
                    <div class="modal-body text-center">

                        <!-- Name -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 60%;">
                        <h2 id="modalName"></h2>
                        </div>

                        <!-- Address -->
                        <div class="mb-3 mx-auto border rounded-pill px-4 pt-3"
                            style="background: #f8f8f8; max-width: 70%;">
                        <h5 class="text-start">Address</h5>
                        <p class="fw-semibold text-center" id="modalAddress"></p>
                        </div>


                        <!-- Email -->
                        <div class="mb-3 mx-auto border rounded-pill px-4 pt-3"
                            style="background: #f8f8f8; max-width: 70%;">
                        <h5 class="text-start">Email</h5>
                        <p class="fw-semibold text-center" id="modalEmail"></p>
                        </div>

                        <!-- Phone Number -->
                        <div class="mb-3 mx-auto border rounded-pill px-4 pt-3"
                            style="background: #f8f8f8; max-width: 70%;">
                        <h5 class="text-start">Phone Number</h5>
                        <p class="fw-semibold text-center" id="modalPhone"></p>
                        </div>

                        <!-- Telephone Number -->
                        <div class="mb-3 mx-auto border rounded-pill px-4 pt-3"
                            style="background: #f8f8f8; max-width: 70%;">
                        <h5 class="text-start">Telephone Number</h5>
                        <p class="fw-semibold text-center" id="modalTelephone"></p>
                        </div>

                        <!-- Date of Birth -->
                        <div class="mb-3 mx-auto border rounded-pill px-4 pt-3"
                            style="background: #f8f8f8; max-width: 70%;">
                        <h5 class="text-start">Date of Birth</h5>
                        <p class="fw-semibold text-center" id="modalDob"></p>
                        </div>

                        <!-- Gender -->
                        <div class="mb-3 mx-auto border rounded-pill px-4 pt-3"
                            style="background: #f8f8f8; max-width: 70%;">
                        <h5 class="text-start">Gender</h5>
                        <p class="fw-semibold text-center" id="modalGender"></p>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="modal-footer border-0 d-flex justify-content-end bg-transparent">
                        <button type="button" class="btn btn-warning" id="modifyUser">Modify User</button>
                        <button type="button" class="btn btn-danger" id="deleteUser">Delete User</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Modal for Modifying User Information -->
        <div class="modal fade" id="editUserDescModal" tabindex="-1" aria-labelledby="editUserDescModal" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="max-width: 70%;">
                <div class="modal-content" style="background-color: gray; border-radius: 20px; padding: 30px;">

                    <!-- Header -->
                    <div class="modal-header border-0 d-flex justify-content-center bg-transparent">
                        <!-- edit modal header-->
                        <div class="d-flex align-items-center justify-content-center border rounded-pill"
                            style="background: white; color: black;">
                            <h1 class="p-4 fw-semibold">Edit User Information</h1>
                        </div>
                    </div>

                    <!-- Body -->
                    <div class="modal-body text-center">

                        <!-- Title -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 60%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="text" id="editTitle" name="editTitle" placeholder="Enter New Title">
                            </form>
                        </div>


                        <!-- First Name -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 60%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="text" id="editFirstName" name="editFirstName" placeholder="Enter New First Name">
                            </form>
                        </div>

                        <!-- Last Name -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 60%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="text" id="editLastName" name="editLastName" placeholder="Enter New Last Name">
                            </form>
                        </div>

                        <!-- Address -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 70%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="text" id="editAddress" name="editAddress" placeholder="Enter New Address">
                            </form>
                        </div>

                        <!-- Country -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 70%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="text" id="editCountry" name="editCountry" placeholder="Enter New Country">
                            </form>
                        </div>

                        <!-- Email -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 70%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="email" id="editEmail" name="editEmail" placeholder="Enter New Email">
                            </form>
                        </div>

                        <!-- Phone Number -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 70%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="tel" id="editPhone" name="editPhone" placeholder="Enter New Phone Number">
                            </form>
                        </div>

                        <!-- Telephone Number -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 70%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="tel" id="editTelephone" name="editTelephone" placeholder="Enter New Telephone Number">
                            </form>
                        </div>

                        <!-- Date of Birth -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: 70%;">
                            <form style="width: 100%;">
                                <input style="width: 100%; border: none;" type="date" id="editDob" name="editDob">
                            </form>
                        </div>

                        <!-- Gender -->
                        <div class="mb-3 mx-auto border rounded-pill p-3 d-flex align-items-center justify-content-center"
                            style="background: #f8f8f8; max-width: fit-content;">
                            <form style="width: 100%;">
                                <select style="width: 100%; border: none;"id="editGender" name="editGender">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </form>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="modal-footer border-0 d-flex justify-content-end bg-transparent">
                        <button type="button" class="btn btn-danger" id="cancel">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save">Save Changes</button>
                    </div>
                
                </div>
            </div>
        </div>



        <script src="script.js"></script>
    </body>
</html>

## CSS File ##

body {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

## JavaScript File ##

const $id = (id) => document.getElementById(id);

const amountInput = $id('amount_input');
const sortBySelect = $id('sort_by');
const bodyContainer = $id('body');

const apiUrl = 'https://randomuser.me/api/';
const maxUsers = 1000;
const minUsers = 0;
const timeout = 3000; // 3 seconds


let currentUsers;  //  store fetched users for name switching functionality and deleting a user

// Main event listeners
amountInput.addEventListener('keypress', async (event) => {
    if (event.key === 'Enter') {
        event.preventDefault();
        await generateUsers();
    }
});
sortBySelect.addEventListener('change', (event) => {
    if (currentUsers.length > 0) {
        event.preventDefault();
        renderUsers(currentUsers, sortBySelect.value);
    }
});

// Main function 
async function generateUsers() {
    const count = Number(amountInput.value.trim());
    const nameDisplay = sortBySelect.value;

    if (!validateInput(count)) return;

    if (count === 0) {
        clearUserRows();
        // Show no users message
        const noUserDiv = document.createElement('div');
        noUserDiv.className = 'alert alert-info text-center';
        noUserDiv.innerText = 'No users to generate.';
        bodyContainer.parentElement.insertBefore(noUserDiv, bodyContainer);
        setTimeout(() => {
            noUserDiv.remove();
        }, timeout)
        return;
    }

    clearUserRows();

    try {
        const users = await fetchRandomUsers(count);
        displayNewUsers(users, nameDisplay);
    } 
    catch (error) {
        showError(error.message);
    }
}

// delete a user from row at the click of the delete user button
function deleteUserFromList(list, user){
    const index = list.findIndex(u => u.name.title + " " + u.name.first + " " + u.name.last === user);
    if (index !== -1) {
        list.splice(index, 1);
        renderUsers(list, sortBySelect.value);
    }
}

// Fetch random users from API with error handling
async function fetchRandomUsers(count) {
    try {
        const response = await fetch(`${apiUrl}?results=${count}`);
        const data = await response.json();

        if (!data.results || !Array.isArray(data.results)) {
            throw new Error('Invalid API response.');
        }

        return data.results;
    } 
    catch (error) {
        if (error.message === 'Failed to fetch') {
            throw new Error('Network error: Please check your internet connection.');
        } 
        else {
            throw error;
        }
    }
}
// Display users
function renderUsers(users, nameDisplay) {
    clearUserRows();  // Remove existing rows


    users.forEach(user => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row mb-2';
        
        function prefill(){
            // Pre-fill edit modal fields
            $id('editTitle').value = user.name.title;
            $id('editFirstName').value = user.name.first;
            $id('editLastName').value = user.name.last;
            $id('editAddress').value = `${user.location.street.number} ${user.location.street.name}, ${user.location.city}, ${user.location.state}, ${user.location.country}, ${user.location.postcode}`;
            $id('editCountry').value = user.location.country;
            $id('editEmail').value = user.email;
            $id('editPhone').value = user.phone;
            $id('editTelephone').value = user.cell;
            $id('editDob').value = user.dob.date;
            $id('editGender').value = user.gender;
            
        }

        // add modal toggling to each row
        const separateModal = new bootstrap.Modal($id('userDescriptionModal'));
        // modal to edit user information
        const editUserModal = new bootstrap.Modal($id("editUserDescModal"));

        // Open modal on double-click, complete with user information and edit functionality
        rowDiv.addEventListener('dblclick', (event) => {
            event.preventDefault();
            
            // Populate display modal
            $id('initials').textContent = user.name.first.charAt(0) + user.name.last.charAt(0);
            $id('modalName').textContent = user.name.title + " " + user.name.first + " " + user.name.last;
            $id('modalAddress').textContent = user.location.fullAddress || (
                user.location.street.number + " " + user.location.street.name + ", " +
                user.location.city + ", " + user.location.state + ", " +
                user.location.country + ", " + user.location.postcode
            );
            $id('modalEmail').textContent = user.email;
            $id('modalPhone').textContent = user.phone;
            $id('modalTelephone').textContent = user.cell;
            $id('modalDob').textContent = user.dob.date;
            $id('modalGender').textContent = capitalizeFirstLetter(user.gender);
            
            // Buttons for the description modal

            const deleteUserButton = $id('deleteUser');
            deleteUserButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    deleteUserFromList(currentUsers, $id('modalName').textContent);
                    separateModal.hide();
                })
            
            
            const modifyUserButton = $id('modifyUser');
            modifyUserButton.onclick = () => { // new button functionality to minimize code
                separateModal.hide();
                prefill();
                editUserModal.show();
            }

            // Buttons for the edit modal
            const cancelButton = $id('cancel');
            cancelButton.onclick = () => {

                $id('editTitle').value = null;
                $id('editFirstName').value = null;
                $id('editLastName').value = null;
                $id('editAddress').value = null;
                $id('editEmail').value = null;
                $id('editPhone').value = null;
                $id('editTelephone').value = null;
                $id('editDob').value = null;
                $id('editGender').value = null;
        
                
                editUserModal.hide();
                separateModal.show();
            }

            // save changes, leave as is for no new data
            const saveButton = $id('save');
            saveButton.onclick = () => {
                if ($id('editTitle').value) user.name.title = $id('editTitle').value;
                if ($id('editFirstName').value) user.name.first = $id('editFirstName').value;
                if ($id('editLastName').value) user.name.last = $id('editLastName').value;
                if ($id('editAddress').value) user.location.fullAddress = $id('editAddress').value;
                if ($id('editCountry').value) user.location.country = $id('editCountry').value;
                if ($id('editEmail').value) user.email = $id('editEmail').value;
                if ($id('editPhone').value) user.phone = $id('editPhone').value;
                if ($id('editTelephone').value) user.cell = $id('editTelephone').value;
                if ($id('editDob').value) user.dob.date = $id('editDob').value;
                if ($id('editGender').value) user.gender = $id('editGender').value;

                renderUsers(currentUsers, sortBySelect.value);
                editUserModal.hide();
            };
            
            separateModal.show();
        });

        const nameCol = document.createElement('div');
        nameCol.className = 'col-md-3 text-center';
        const displayName = (nameDisplay === 'first_name') ? user.name.first : user.name.last;
        nameCol.textContent = displayName;
    
        const genderCol = document.createElement('div');
        genderCol.className = 'col-md-3 text-center';
        genderCol.textContent = capitalizeFirstLetter(user.gender);

        const emailCol = document.createElement('div');
        emailCol.className = 'col-md-3 text-center text-truncate';
        emailCol.textContent = user.email;

        const countryCol = document.createElement('div');
        countryCol.className = 'col-md-3 text-center';
        countryCol.textContent = user.location.country;


        rowDiv.appendChild(nameCol);
        rowDiv.appendChild(genderCol);
        rowDiv.appendChild(emailCol);
        rowDiv.appendChild(countryCol);

        bodyContainer.appendChild(rowDiv);
    });
}
function displayNewUsers(users, nameDisplay) {
    currentUsers = users;  // assign and store users for name sorting
    renderUsers(currentUsers, nameDisplay);
}

// Show error alert as a div element for three seconds
function showError(message) {
    clearUserRows();

    const errorDiv = document.createElement('div');
    errorDiv.className = 'alert alert-danger text-center';
    errorDiv.innerText = message;
    bodyContainer.parentElement.insertBefore(errorDiv, bodyContainer);
    setTimeout(() => {
            errorDiv.remove();
        }, timeout)
    return
}
// Validate user input amount
function validateInput(amount) {
    if (isNaN(amount) || amount === '') {
        showError('Please enter a valid number.');
        return false;
    }
    if (amount <= minUsers || amount >= maxUsers) {
        showError(`Please enter a number between ${minUsers} and ${maxUsers}.`);
        return false;
    }
    return true;
}

// Helper function for gender
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

// Clear previous user results rows except the header row
function clearUserRows() {
    // Remove all rows after the header row
    while (bodyContainer.children.length > 1) {
        bodyContainer.removeChild(bodyContainer.lastChild);
    }
}

